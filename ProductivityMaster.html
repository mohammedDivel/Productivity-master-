<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Productivity Master — macOS</title>
<style>
  :root{--bg:#0f1115;--panel:#1e1e22;--text:#eaf2ff;--muted:#9aa9bf;--accent:#007aff;--good:#30d158;--warn:#ffd60a;--danger:#ff453a;}
  body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Arial;background:var(--bg);color:var(--text)}
  .app{max-width:1100px;margin:12px auto;padding:12px} .hdr{display:flex;justify-content:space-between;align-items:center}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(90deg,var(--accent),#5856d6);display:flex;align-items:center;justify-content:center;color:#042;font-weight:800}
  .layout{display:grid;grid-template-columns:1fr 360px;gap:12px;margin-top:12px}
  .card{background:var(--panel);padding:12px;border-radius:10px}
  input,textarea,select,button{font-family:inherit}
  input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px;color:var(--text)}
  button{background:linear-gradient(90deg,var(--accent),#5856d6);border:none;color:#021;padding:8px 10px;border-radius:8px;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
  .check-block{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;margin:8px 0}
  .macro-drawer{background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;max-height:160px;overflow:auto;margin-top:8px}
  .toast{position:fixed;right:18px;top:18px;background:var(--panel);padding:10px;border-radius:8px;display:none;z-index:999}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="hdr"><div style="display:flex;gap:12px;align-items:center"><div class="logo">PM</div><div><h2 style="margin:0">Productivity Master</h2><div style="color:var(--muted)">macOS style • English • Offline</div></div></div>
  <div style="display:flex;gap:8px;align-items:center"><label style="color:var(--muted)">Work hrs <input id="workHours" type="number" value="8" style="width:70px"/></label><button id="startShift">Start</button><button id="eyeMode" class="btn-ghost">Eye</button><button id="exportJSON" class="btn-ghost">Export</button></div></div>
  <div class="layout">
    <div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center"><div><div style="color:var(--muted)">Add ticket (checklist required unless reply)</div><div style="display:flex;gap:8px;margin-top:8px"><input id="ticketInput" placeholder="Ticket ID" /><button id="btnAdd">Add</button><button id="btnHistory" class="btn-ghost">History</button></div></div><div style="width:220px"><div style="font-weight:700;font-size:20px" id="goalCount">0</div><div style="color:var(--muted)">tickets required</div></div></div>
        <div style="margin-top:12px"><strong>Checklist (fast)</strong>
          <div class="check-block"><label><input type="checkbox" id="blk_prep"> <strong>Preparation</strong></label></div>
          <div class="check-block"><label><input type="checkbox" id="blk_under"> <strong>Understand</strong></label></div>
          <div class="check-block"><label><input type="checkbox" id="blk_res"> <strong>Resolve & Close</strong></label></div>
          <div style="margin-top:8px"><button id="markAll" class="btn-ghost">Mark All Done</button><span style="color:var(--muted);margin-left:8px">If exists in history (reply) checklist skipped</span></div>
        </div>
      </div>
      <div class="card" style="margin-top:12px"><strong>Email Builder & Grammar</strong>
        <div style="display:flex;gap:8px;margin-top:8px"><textarea id="emailArea" style="flex:1" placeholder="Write reply..."></textarea><div style="width:280px"><div style="display:flex;justify-content:space-between"><div style="color:var(--muted)">Grammar Suggestions</div><div><select id="rephraseMode"><option value="neutral">Neutral</option><option value="formal">Formal</option><option value="simple">Simple</option></select><button id="checkGrammar" class="btn-ghost">Check</button></div></div><div id="grammarOutput" style="margin-top:8px;max-height:220px;overflow:auto;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px"></div></div></div>
        <div style="margin-top:8px"><button id="applyTemplate" class="btn-ghost">Apply Template</button><button id="saveSnippet" class="btn-ghost">Save Snippet</button><span style="color:var(--muted);margin-left:8px">Snippets saved per ticket</span></div>
      </div>
      <div class="card" style="margin-top:12px"><strong>Log & History</strong><div style="margin-top:8px;display:flex;gap:8px"><input id="searchBox" placeholder="Search..." style="flex:1"/><select id="filterDay"><option value="">All days</option></select></div><div id="logArea" style="margin-top:8px;max-height:300px;overflow:auto"></div></div>
    </div>
    <div>
      <div class="card"><strong>Quick Stats</strong><div style="margin-top:8px;color:var(--muted)">Total / This hour / Remaining</div><div style="display:flex;gap:8px;margin-top:8px"><div style="flex:1;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px"><div style="color:var(--muted)">Total</div><div id="totalTickets" style="font-weight:700">0</div></div><div style="flex:1;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px"><div style="color:var(--muted)">This hour</div><div id="hourCount" style="font-weight:700">0</div></div></div><div style="margin-top:8px"><div style="color:var(--muted)">Remaining this hour</div><div id="remaining" style="font-weight:700">0</div></div></div>
      <div class="card" style="margin-top:12px"><strong>Weekly Breaks & Lunch</strong><div style="margin-top:8px"><label>Weekday<select id="daySelect"><option value="mon">Monday</option><option value="tue">Tuesday</option><option value="wed">Wednesday</option></select></label><div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px"><div><div class="small">Break1 start</div><input id="b1s" type="time"/></div><div><div class="small">Break1 end</div><input id="b1e" type="time"/></div><div><div class="small">Lunch start</div><input id="ls" type="time"/></div><div><div class="small">Lunch end</div><input id="le" type="time"/></div></div><div style="margin-top:8px"><button id="saveDay">Save Day</button><button id="copyMon" class="btn-ghost">Copy Monday</button></div></div></div>
      <div class="card" style="margin-top:12px"><strong>Daily Options</strong><div style="margin-top:8px"><div style="display:flex;gap:8px"><div style="flex:1"><div class="small">Low Volume start</div><input id="lvS" type="time"/></div><div style="flex:1"><div class="small">Low Volume end</div><input id="lvE" type="time"/></div></div><div style="margin-top:8px"><button id="saveDaily" class="btn-ghost">Save Daily</button><button id="toggleLv" class="btn-ghost">Toggle LV</button></div></div><div style="margin-top:8px"><div class="small">Meetings</div><div id="meetingsArea" style="margin-top:6px"></div><div style="margin-top:8px"><button id="addMeeting" class="btn-ghost">Add Meeting</button><button id="clearMeetings" class="btn-ghost">Clear</button></div></div></div>
      <div class="card" style="margin-top:12px"><strong>Macro Drawers</strong><div style="margin-top:8px"><div class="small">Drawer A</div><div id="macroA" class="macro-drawer"></div><div class="small" style="margin-top:8px">Drawer B</div><div id="macroB" class="macro-drawer"></div><div class="small" style="margin-top:8px">Auto suggestions</div><div id="macroSuggest" class="macro-drawer"></div></div></div>
      <div class="card" style="margin-top:12px"><strong>Backup & Options</strong><div style="margin-top:8px"><button id="manualBackup" class="btn-ghost">Backup Now</button><button id="restoreBtn" class="btn-ghost">Restore</button></div></div>
    </div>
  </div>
  <div style="text-align:center;margin-top:10px;color:var(--muted)">Productivity Master — offline • macOS styled</div>
</div>
<div id="toast" class="toast"></div>
<div id="histModal" style="display:none;position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:var(--panel);padding:12px;border-radius:8px;z-index:9999;max-width:900px;width:90%">
  <div style="display:flex;justify-content:space-between;align-items:center"><strong>History & Search</strong><div><input id="histSearch" placeholder="search" style="width:240px"/> <button id="closeHist" class="btn-ghost">Close</button></div></div><div id="histContent" style="margin-top:8px;max-height:420px;overflow:auto"></div>
</div>
<script>
const STORAGE_KEY="pm_master_safe_v1";
let store = JSON.parse(localStorage.getItem(STORAGE_KEY) || "null") || {version:1,settings:{workHours:8},weekSchedule:{},daily:{},meetings:[],macros:{A:[],B:[],suggestions:[],greeting:"Hi {{customerName}},",confirm:"Am I correct?",closing:"Please let me know if you have any other concerns."},days:{},historyList:[]};
function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(store)); scheduleIndexedBackup(); }
function nowISO(){return new Date().toISOString();} function dateKey(iso){return new Date(iso).toISOString().slice(0,10);} function fmtTime(iso){const d=new Date(iso);let h=d.getHours(),m=("0"+d.getMinutes()).slice(-2),am=h>=12?"PM":"AM";h=h%12||12;return `${h}:${m} ${am}`;}
let idb=null; (function(){ if(!window.indexedDB) return; const r=indexedDB.open("pm_safe_db",1); r.onupgradeneeded=()=> r.result.createObjectStore("b",{keyPath:"k"}); r.onsuccess=()=> idb=r.result; })();
function scheduleIndexedBackup(){ if(!idb) return; try{ const tx=idb.transaction("b","readwrite"); tx.objectStore("b").put({k:"latest",data:store}); }catch(e){} }
let audioCtx=null; function beep(type="soft"){ try{ if(!audioCtx) audioCtx=new (window.AudioContext||window.webkitAudioContext)(); const t=audioCtx.currentTime; const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type="sine"; if(type==="alert"){o.frequency.value=600; g.gain.value=0.12;} else if(type==="soft"){o.frequency.value=1000; g.gain.value=0.06;} else {o.frequency.value=1200; g.gain.value=0.07;} o.connect(g); g.connect(audioCtx.destination); o.start(t); g.gain.exponentialRampToValueAtTime(0.0001, t+0.12); setTimeout(()=> o.stop(),160);}catch(e){} }
function toast(msg,ttl=3500){ const el=document.getElementById("toast"); el.innerText=msg; el.style.display="block"; beep("soft"); setTimeout(()=> el.style.display="none", ttl); }
const ticketInput=document.getElementById("ticketInput"), btnAdd=document.getElementById("btnAdd"); const blk_prep=document.getElementById("blk_prep"), blk_under=document.getElementById("blk_under"), blk_res=document.getElementById("blk_res"); const markAll=document.getElementById("markAll"); const emailArea=document.getElementById("emailArea"), checkGrammar=document.getElementById("checkGrammar"), grammarOutput=document.getElementById("grammarOutput"); const applyTemplate=document.getElementById("applyTemplate"), saveSnippet=document.getElementById("saveSnippet"); const histModal=document.getElementById("histModal"), histContent=document.getElementById("histContent"), histSearch=document.getElementById("histSearch"), closeHist=document.getElementById("closeHist"); const logArea=document.getElementById("logArea"), searchBox=document.getElementById("searchBox"), filterDay=document.getElementById("filterDay"); const totalTickets=document.getElementById("totalTickets"), hourCount=document.getElementById("hourCount"), remaining=document.getElementById("remaining"); const macroA=document.getElementById("macroA"), macroB=document.getElementById("macroB"), macroSuggest=document.getElementById("macroSuggest"); const workHoursInput=document.getElementById("workHours");
workHoursInput.value = store.settings.workHours || 8;
markAll.addEventListener("click", ()=>{ blk_prep.checked=blk_under.checked=blk_res.checked=true; toast("Checklist marked"); });
function renderMacros(){ macroA.innerHTML=""; macroB.innerHTML=""; macroSuggest.innerHTML=""; (store.macros.A||[]).forEach((m,i)=>{ const div=document.createElement("div"); div.style.display="flex"; div.style.justifyContent="space-between"; div.style.marginBottom="6px"; div.innerHTML = `<div><strong>${m.name}</strong><div style="color:var(--muted)">${m.content.slice(0,80)}${m.content.length>80?"...":""}</div></div><div><button class="useMacro" data-d="A" data-i="${i}">Use</button></div>`; macroA.appendChild(div); }); (store.macros.B||[]).forEach((m,i)=>{ const div=document.createElement("div"); div.style.display="flex"; div.style.justifyContent="space-between"; div.style.marginBottom="6px"; div.innerHTML = `<div><strong>${m.name}</strong><div style="color:var(--muted)">${m.content.slice(0,80)}${m.content.length>80?"...":""}</div></div><div><button class="useMacro" data-d="B" data-i="${i}">Use</button></div>`; macroB.appendChild(div); }); (store.macros.suggestions||[]).forEach((m,i)=>{ const div=document.createElement("div"); div.style.display="flex"; div.style.justifyContent="space-between"; div.style.marginBottom="6px"; div.innerHTML = `<div><strong>${m.name}</strong><div style="color:var(--muted)">${m.content.slice(0,80)}${m.content.length>80?"...":""}</div></div><div><button class="useMacro" data-d="S" data-i="${i}">Use</button></div>`; macroSuggest.appendChild(div); });
document.addEventListener("click",(e)=>{ const b=e.target.closest(".useMacro"); if(!b) return; const d=b.getAttribute("data-d"), i=parseInt(b.getAttribute("data-i")); let m; if(d==="A") m=store.macros.A[i]; else if(d==="B") m=store.macros.B[i]; else m=store.macros.suggestions[i]; if(m){ emailArea.value = (emailArea.value?emailArea.value+"\\n\\n":"") + m.content; toast("Macro inserted"); } });
const KEYWORDS=[{k:["refund","chargeback"],name:"Refund",content:"Hi {{customer}}, I issued a refund. It will reflect in 3-10 business days."},{k:["dns","nameserver"],name:"DNS",content:"Hi {{customer}}, Please check nameservers..."}];
function updateSuggestions(text){ const found=[]; const low=(text||"").toLowerCase(); KEYWORDS.forEach(map=>{ map.k.forEach(kw=>{ if(low.includes(kw) && !found.includes(map)) found.push(map); }); }); store.macros.suggestions = found.map(f=>({name:f.name,content:f.content})); renderMacros(); }
btnAdd.addEventListener("click", ()=> addTicket(ticketInput.value.trim())); ticketInput.addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ addTicket(ticketInput.value.trim()); ticketInput.value=""; } });
function exists(id){ return store.historyList.includes(id); }
function addTicket(id){ if(!id){ toast("Enter ticket ID"); beep("alert"); return; } const isReply = exists(id); if(!isReply){ if(!(blk_prep.checked && blk_under.checked && blk_res.checked)){ toast("Complete checklist first or mark all"); beep("alert"); return; } } const iso=nowISO(), k=dateKey(iso); if(!store.days[k]) store.days[k]={date:new Date(iso).toLocaleDateString(), tickets:[]}; const entry={id,iso,time:fmtTime(iso),content:emailArea.value||"",isReply:isReply}; store.days[k].tickets.push(entry); if(!store.historyList.includes(id)) store.historyList.push(id); if(!isReply){ blk_prep.checked=blk_under.checked=blk_res.checked=false; } emailArea.value=""; save(); renderAll(); toast(isReply?"Reply logged (checklist skipped)":"Ticket logged"); }
function renderAll(){ let total=0; Object.keys(store.days).forEach(k=> total += (store.days[k].tickets||[]).length); document.getElementById("totalTickets").innerText = total; const workH = parseFloat(workHoursInput.value)||store.settings.workHours||8; store.settings.workHours = workH; save(); const prodH = Math.max(0, workH - computeNonProductiveMinutes()/60); const goal = Math.round(prodH*4); document.getElementById("goalCount").innerText = goal; const now=new Date(), h=now.getHours(), tk= dateKey(now.toISOString()); const today = store.days[tk]||{tickets:[]}; const hourCount = today.tickets.reduce((s,t)=> s + (new Date(t.iso).getHours()===h?1:0),0); document.getElementById("hourCount").innerText = hourCount; document.getElementById("remaining").innerText = Math.max(0,4-hourCount); renderLog(); populateFilter(); renderMacros(); }
function renderLog(){ logArea.innerHTML=""; const keys=Object.keys(store.days).sort((a,b)=> a<b?1:-1); if(keys.length===0){ logArea.innerHTML="<div style=\'color:var(--muted)\'>No tickets yet.</div>"; return; } keys.forEach(k=>{ const day=store.days[k]; const wrap=document.createElement("div"); wrap.innerHTML = `<div style="background:rgba(96,165,250,0.06);padding:6px;border-radius:6px;margin:8px 0">${day.date}</div>`; const tbl=document.createElement("table"); tbl.innerHTML = "<thead><tr><th>Ticket</th><th>Time</th><th>Snippet</th><th>Reply?</th></tr></thead>"; const tbody=document.createElement("tbody"); (day.tickets||[]).forEach(t=>{ const tr=document.createElement("tr"); tr.innerHTML = `<td><a href="#" class="openTicket" data-k="${k}" data-id="${t.id}">${t.id}</a></td><td>${t.time}</td><td style="font-family:monospace">${(t.content||"").slice(0,80)}</td><td>${t.isReply? "Yes":"No"}</td>`; tbody.appendChild(tr); }); tbl.appendChild(tbody); wrap.appendChild(tbl); logArea.appendChild(wrap); }); document.querySelectorAll(".openTicket").forEach(a=> a.addEventListener("click", e=>{ e.preventDefault(); openTicket(a.getAttribute("data-k"), a.getAttribute("data-id")); })); }
function openTicket(k,id){ const t = (store.days[k].tickets||[]).find(x=> x.id===id); if(!t) return; emailArea.value = t.content || ""; toast("Loaded ticket"); histModal.style.display="none"; }
function populateFilter(){ const keys=Object.keys(store.days).sort((a,b)=> a<b?1:-1); filterDay.innerHTML = "<option value=\'\'>All days</option>"; keys.forEach(k=> filterDay.innerHTML += `<option value="${k}">${store.days[k].date} (${k})</option>`); }
/* Grammar: simple replacements */
function grammarCheckText(text){ let out=text; const notes=[]; const rules=[{find:" i ",fix:" I "},{find:" dont ",fix:" don't "},{find:" recieve ",fix:" receive "}]; rules.forEach(r=>{ if(out.toLowerCase().includes(r.find.trim())){ out = out.split(r.find).join(r.fix); notes.push("Applied: "+r.fix.trim()); } }); return {rephrased:out,notes}; }
checkGrammar.addEventListener("click", ()=>{ const text=emailArea.value||""; if(!text){ toast("Write something"); return; } toast("Checking..."); setTimeout(()=>{ const res=grammarCheckText(text); grammarOutput.innerHTML = res.notes.map(n=>`<div style="color:var(--muted)">${n}</div>`).join("") + `<pre style="white-space:pre-wrap;margin-top:8px;background:rgba(0,0,0,0.2);padding:8px;border-radius:8px">${res.rephrased}</pre>`; const btn=document.createElement("button"); btn.innerText="Apply"; btn.className="btn-ghost"; btn.addEventListener("click", ()=>{ emailArea.value=res.rephrased; toast("Applied"); }); grammarOutput.appendChild(btn); updateSuggestions(emailArea.value||""); },400); });
applyTemplate.addEventListener("click", ()=>{ const g = store.macros.greeting || "Hi {{customerName}},\nThank you for contacting support."; const q = store.macros.confirm || "Am I correct?"; const c = store.macros.closing || "Please let me know if you have any other concerns."; const body = emailArea.value || ""; emailArea.value = `${g}\n\n${q}\n\n${body}\n\n${c}`; toast("Template assembled"); });
saveSnippet.addEventListener("click", ()=>{ const txt=emailArea.value.trim(); if(!txt) return toast("Nothing to save"); store.macros.A = store.macros.A || []; store.macros.A.unshift({name:"Snippet "+new Date().toLocaleString(), content:txt}); if(store.macros.A.length>200) store.macros.A.length=200; save(); renderMacros(); toast("Snippet saved"); });
function renderHistory(q=""){ histContent.innerHTML=""; const keys=Object.keys(store.days).sort((a,b)=> a<b?1:-1); keys.forEach(k=>{ const day=store.days[k]; const wrap=document.createElement("div"); wrap.innerHTML=`<div style="background:rgba(96,165,250,0.06);padding:6px;border-radius:6px;margin:8px 0">${day.date}</div>`; const tbl=document.createElement("table"); tbl.innerHTML="<thead><tr><th>Ticket</th><th>Time</th><th>Snippet</th></tr></thead>"; const tbody=document.createElement("tbody"); (day.tickets||[]).forEach(t=>{ if(q && !(`${t.id} ${t.content}`.toLowerCase().includes(q.toLowerCase()))) return; const tr=document.createElement("tr"); tr.innerHTML=`<td>${t.id}</td><td>${fmtTime(t.iso)}</td><td style="font-family:monospace">${(t.content||"").slice(0,120)}</td>`; tbody.appendChild(tr); }); tbl.appendChild(tbody); wrap.appendChild(tbl); histContent.appendChild(wrap); }); }
document.getElementById("btnHistory").addEventListener("click", ()=>{ histModal.style.display="block"; renderHistory(""); }); closeHist.addEventListener("click", ()=> histModal.style.display="none"); histSearch.addEventListener("input", ()=> renderHistory(histSearch.value.trim()));
document.getElementById("saveDay").addEventListener("click", ()=>{ const d=document.getElementById("daySelect").value; store.weekSchedule = store.weekSchedule||{}; store.weekSchedule[d] = {b1s:document.getElementById("b1s").value,b1e:document.getElementById("b1e").value,ls:document.getElementById("ls").value,le:document.getElementById("le").value}; save(); toast("Day saved"); });
document.getElementById("copyMon").addEventListener("click", ()=>{ const mon=store.weekSchedule["mon"]; if(!mon) return alert("No Monday schedule"); ["tue","wed","thu","fri","sat","sun"].forEach(d=> store.weekSchedule[d]=Object.assign({},mon)); save(); toast("Copied Monday"); });
document.getElementById("saveDaily").addEventListener("click", ()=>{ const s=document.getElementById("lvS").value,e=document.getElementById("lvE").value; if(!s||!e) return alert("Enter LV times"); store.daily.lvStart=s; store.daily.lvEnd=e; store.daily.lvActive=true; save(); toast("Low Volume set"); });
document.getElementById("toggleLv").addEventListener("click", ()=>{ store.daily.lvActive = !store.daily.lvActive; save(); toast("Toggled LV: "+(store.daily.lvActive?"ON":"OFF")); });
document.getElementById("addMeeting").addEventListener("click", ()=>{ const date=prompt("Meeting date (YYYY-MM-DD) or empty for today:"), start=prompt("Start (HH:MM)"), end=prompt("End (HH:MM)"); if(!start||!end) return alert("Invalid"); store.meetings.push({dateKey: date?date.trim():null, start:start.trim(), end:end.trim()}); save(); renderAll(); toast("Meeting added"); });
document.getElementById("manualBackup").addEventListener("click", manualBackup); function manualBackup(){ const out=JSON.stringify(store,null,2); const blob=new Blob([out],{type:"application/json"}); const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=`pm_backup_${new Date().toISOString().slice(0,10)}.json`; document.body.appendChild(a); a.click(); a.remove(); scheduleIndexedBackup(); toast("Backup downloaded"); }
function parseTime(t,ref){ if(!t) return null; const [hh,mm]=t.split(":").map(x=>parseInt(x,10)); const d=new Date(ref); d.setHours(hh,mm,0,0); return d; }
function computeNonProductiveMinutes(){ const now=new Date(); const wd=["sun","mon","tue","wed","thu","fri","sat"][now.getDay()]; const sched=store.weekSchedule[wd]||{}; let minutes=0; function add(s,e){ if(!s||!e) return; const ss=parseTime(s,now), ee=parseTime(e,now); if(ee>ss) minutes += Math.round((ee-ss)/60000); } add(sched.b1s,sched.b1e); add(sched.ls,sched.le); if(store.daily && store.daily.lvStart && store.daily.lvActive) add(store.daily.lvStart, store.daily.lvEnd); (store.meetings||[]).forEach(m=>{ if(m.dateKey && m.dateKey !== dateKey(new Date().toISOString())) return; add(m.start,m.end); }); return minutes; }
let lastChair=Date.now(), lastBase=Date.now(); const CHAIR=90*60*1000, BASE=15*60*1000; setInterval(()=>{ renderAll(); checkUpcoming(); const now=Date.now(); if(now-lastChair>=CHAIR){ lastChair=now; toast("Stand up for 1 minute"); beep("soft"); } if(now-lastBase>=BASE){ lastBase=now; baseCheck(); } }, 9000);
function baseCheck(){ const now=new Date(); const startDay=new Date(now.getFullYear(),now.getMonth(),now.getDate(),0,0,0); const elapsed=(now-startDay)/3600000; const nonProd=computeNonProductiveMinutes()/60; const prodElapsed=Math.max(0, elapsed-nonProd); const expected = Math.floor(prodElapsed*4); const key=dateKey(now.toISOString()); const actual = (store.days[key] && store.days[key].tickets)? store.days[key].tickets.length:0; if(actual < expected){ toast(`Behind target: ${actual}/${expected} — pick up pace`); beep("alert"); } }
function checkUpcoming(){ const now=new Date(), plus5=new Date(now.getTime()+5*60000); const wd=["sun","mon","tue","wed","thu","fri","sat"][now.getDay()]; const sched= store.weekSchedule[wd] || {}; [["b1s","Break starting soon"],["ls","Lunch starting soon"],["b2s","Break starting soon"]].forEach(([k,msg])=>{ const t=sched[k]; if(!t) return; const dt=parseTime(t,now); if(dt>now && dt<=plus5){ toast(msg); beep("soft"); } }); if(store.daily && store.daily.lvStart && store.daily.lvActive){ const dt=parseTime(store.daily.lvStart, now); if(dt>now && dt<=plus5){ toast("Low Volume starting soon"); beep("soft"); } } (store.meetings||[]).forEach(m=>{ const key=m.dateKey||dateKey(new Date().toISOString()); if(key!==dateKey(new Date().toISOString())) return; const dt=parseTime(m.start, now); if(dt>now && dt<=plus5){ toast("Meeting in 5 minutes"); beep("soft"); } }); }
document.getElementById("eyeMode").addEventListener("click", ()=>{ document.body.style.filter = document.body.style.filter? "":"brightness(.95)"; toast("Eye mode toggled"); });
document.addEventListener("keydown", e=>{ if(e.ctrlKey && e.key==="Enter"){ addTicket(ticketInput.value.trim()); ticketInput.value=""; } });
ticketInput.addEventListener("input", ()=>{ const v=ticketInput.value.trim(); if(v && store.historyList.includes(v)) toast("Existing ticket — reply (checklist skipped)"); }); emailArea.addEventListener("input", ()=> updateSuggestions(emailArea.value||""));
renderAll(); renderMacros(); window.addEventListener("beforeunload", ()=> save());
</script>
</body>
</html>